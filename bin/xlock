#!/bin/bash

tmpdir="/tmp/"
tmpfile="${tmpdir}head_tmp.png"
image="$HOME/.local/share/icons/xlock/locked.png"
lib="$HOME/.local/lib/xlock/individual_lock.sh"
main="${tmpdir}head_0.png"
extended="${tmpdir}head_1.png"
out="${tmpdir}screen.png"
rm -f $out $main $extended

. $lib

function blur() {
	convert $1 -blur 0x8 $1
}

function overlay() {
	if [[ -f $image ]]; then
		convert $1 $image -gravity center -composite -matte $1
	fi
}

function combine() {
	width="$((${main_info[w]} + ${extended_info[w]}))"
	heigth="${main_info[h]}"
	ext_x="${extended_info[x]}"
	ext_y="${extended_info[y]}"

	convert -page "${width}x${heigth}+0+0" $1 \
			-page "+$ext_x+$ext_y" $2 \
			-flatten $out
}


blur $main
overlay $main

if [ -e $extended ]; then
	blur $extended
	overlay $extended
	combine $main $extended
else
	mv $main $out
fi

i3lock -u -i $out
