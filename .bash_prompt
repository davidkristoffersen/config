#!/bin/bash

PROMPT_COMMAND=__prompt_command # Func to gen PS1 after CMDs
__prompt_command() {
    local EXIT="$?"             # This needs to be first
    PS1=""

    local rcol='\[\e[0m\]'
    local red='\[\e[0;31m\]'
    local gre='\[\e[0;32m\]'
    local byel='\[\e[1;33m\]'
    local bblu='\[\e[1;34m\]'
    local bpur='\[\e[1;35m\]'
	local fbla='\[\e[2m\]'

	# Git branch detection
	local branch="$(git branch 2>/dev/null | grep '^*' | colrm 1 2) "
 	if [ "$branch" == " " ]; then
		branch=''
	fi

	local pre="$rcol"
	local post="$rcol "

    PS1+="$pre"

	# Add user and host if it is a ssh session
	if $SSH; then
		PS1+="$byel[$rcol\u$rcol"
		PS1+="$fbla@$rcol"
		PS1+="${HOSTNAME%%.*}$byel]$rcol "
	fi

	PS1+="$bpur$branch$rcol"
	PS1+="$bblu\W$rcol "

	# Color based exit status
    if [ $EXIT != 0 ]; then
        PS1+="${red}</3${rcol}"
    else
        PS1+="${gre}<3${rcol}"
    fi

    PS1+="$post"
}
